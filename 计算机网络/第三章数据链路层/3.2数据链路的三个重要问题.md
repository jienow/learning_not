# 3.2.1封装成帧与透明传输
## 封装成帧
概念：数据链路层给上层传输下来的协议数据单元加上帧首部和帧尾部
提高效率：为了尽可能提高数据传输的效率，帧的数据传输的数据载荷的长度应该尽可能大于首部和尾部的长度
最大传输单元（MTU）：考虑到1.对缓存空间的需求 2. 差错控制等诸多因素，每一种数据链路的协议都规定了数据载荷的长度上限
## 透明传输
### 透明传输存在的意义：
我们通过帧首部和帧尾部来判断一个帧的开始和结束，但是这个判断是由帧里面的固定编码来实现的，这很容易造成上层传输下来的协议数据单元里面包含这个固定编码，导致帧提前结束，形成了对上层的约束
### 透明传输的概念：
通过某种措施，使得数据链路层对上层传下来的pdu数据没有限制，仿佛数据链路不存在一样
### **实现方法**：
概念：
1. 实现一种“转义”字符，对数据载荷里面的同义帧界定符进行转义，
2. 当然，数据载荷里面同样也有“转义”字符的同义字符，我们也对其进行转义，
3. 当接收方接受了帧，扫描这个数据载荷，对里面的数据进行反转义即可
举例：
帧界定符是0 6个1 0，转义字符为每5个字符加一个0，接收方每5个字符去一个零
![[Pasted image 20250102160209.png]]
# 3.2.2差错检测
概念：帧在传输过程中会出现误码，接收方通过在帧尾部的检错码，来检查错误
## 检错方法
### 奇偶校验
**奇校验**：在发送数据后面添加一个校验位，使得整段数据的1的个数为奇数
**偶校验**：在发送数据后面添加一个校验位，使得整段数据的1的个数为偶数
### 循环冗余校验（CRC）
需要**待发送的数据**和**生成多项式G(X) = $X^3$ + $X^2$ + 1** ,作为除数，这里的**1必须要有**
步骤：
1. 发送方：
	1. 被除数 = 待发送的数据 + 0\*n（个数为G(X)最高项的个数
	2. 除数 = 生成多项式的各项系数构成的比特串
	3. ==**模二进制算法**==： 对应位异或运算
	4. 检查余数：其位数应该与生成多项式最高位数（除数相同）
	5. 把余数拼到待发送的数据后面，发送出去
2. 接收方：
	1. 具有同样的G（X）
	2. 把发送的数据和余数再进行上面的运算，得余数为0，则无误码
### 纠错码
海明码
数据链路层仅使用（CRC）
# 3.2.3可靠运输
## 基本概念
1. **不可靠传输服务**：
	1. 收到误码帧，直接丢弃
	2. 未收到帧，什么也不做
2. **可靠运输服务**：
	1. 实现发送方发送什么，接收方都能收到正确的内容
3. **传输差错**：不一定发生在数据链路层，在上层也有可能发生
	1. 上层：
		1. 分组重复
		2. 分组失序
		3. 分组丢失
	2. 数据链路层：
		1. 误码（比特差错）：出现在数据链路层及其下层
## 实现机制
### 停止-等待协议
概述：发送方发送一个分组，接收方接受之后，向发送方发送一个确认分组信号，发送方接收到确认分组信号后，再发送新的分组
**NAK为否认机制**
![[Pasted image 20250102172117.png]]
#### 新机制
##### 超时重传机制（RTO）
当发送的数据，接受方没有接受到或者ack发送出去发送方接收不到，发送方一直无法收到ack信号，发送方就会在一段时间之后重新发送
**RTT**：为略大于收发双方的平均往返时间
![[Pasted image 20250102172652.png]]

##### 数据分组编号机制

![[Pasted image 20250102172908.png]]
重复接受之后，需要再次发送ack确认信号
![[Pasted image 20250102173011.png]]
ack也需要编号，该编号与数据分组编号一致
![[Pasted image 20250102173104.png]]

注意事项：期末考试应该不会考这么细，需要的话，重新看
![[Pasted image 20250102173850.png]]
==信道利用率计算==
**注意： 利用率 = 时间/时间**
**RTT为单向信号发送时间**
![[Pasted image 20250102174035.png]]
何时使用
![[Pasted image 20250102174242.png]]
### 回退N帧协议
概述：一次性发送一堆数据分组，等待接收方接受，发送回ack
![[Pasted image 20250102224459.png]]
#### 发送方
![[Pasted image 20250102224829.png]]
#### 接收方
![[Pasted image 20250102224925.png]]
#### 滑动窗口协议
![[Pasted image 20250102225035.png]]
#### 累积确认
一般状态下，是接受一个分组信息，发送一个确认信息
![[Pasted image 20250102225420.png]]
累积确认，只发送第一个分组确认和最后一个接受的分组确认
![[Pasted image 20250102225521.png]]
累计确认的优缺点：pass
Wt超过取值范围的上限，会发生什么？pass
